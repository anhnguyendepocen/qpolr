<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Quantitative Politics with R</title>
  <meta name="description" content="Quantitative Politics with R">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Quantitative Politics with R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Quantitative Politics with R" />
  
  
  

<meta name="author" content="Erik Gahner Larsen and ZoltÃ¡n Fazekas">


<meta name="date" content="2019-02-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="4-datadownload.html">
<link rel="next" href="6-dataviz.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-r"><i class="fa fa-check"></i><b>1.2</b> Installing <code>R</code></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.4</b> Installing <code>R</code> packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#errors-and-help"><i class="fa fa-check"></i><b>1.5</b> Errors and help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-basics.html"><a href="2-basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="2-basics.html"><a href="2-basics.html#numbers-as-data"><i class="fa fa-check"></i><b>2.1</b> Numbers as data</a></li>
<li class="chapter" data-level="2.2" data-path="2-basics.html"><a href="2-basics.html#missing-values-na"><i class="fa fa-check"></i><b>2.2</b> Missing values (<code>NA</code>)</a></li>
<li class="chapter" data-level="2.3" data-path="2-basics.html"><a href="2-basics.html#logical-operators"><i class="fa fa-check"></i><b>2.3</b> Logical operators</a></li>
<li class="chapter" data-level="2.4" data-path="2-basics.html"><a href="2-basics.html#text-as-data"><i class="fa fa-check"></i><b>2.4</b> Text as data</a></li>
<li class="chapter" data-level="2.5" data-path="2-basics.html"><a href="2-basics.html#data-frames"><i class="fa fa-check"></i><b>2.5</b> Data frames</a></li>
<li class="chapter" data-level="2.6" data-path="2-basics.html"><a href="2-basics.html#import-and-export-data-frames"><i class="fa fa-check"></i><b>2.6</b> Import and export data frames</a></li>
<li class="chapter" data-level="2.7" data-path="2-basics.html"><a href="2-basics.html#environment"><i class="fa fa-check"></i><b>2.7</b> Environment</a></li>
</ul></li>
<li class="part"><span><b>I Working with data</b></span></li>
<li class="chapter" data-level="3" data-path="3-data.html"><a href="3-data.html"><i class="fa fa-check"></i><b>3</b> Data management</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data.html"><a href="3-data.html#selecting-variables-select"><i class="fa fa-check"></i><b>3.1</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="3.2" data-path="3-data.html"><a href="3-data.html#selecting-observations-filter"><i class="fa fa-check"></i><b>3.2</b> Selecting observations: <code>filter()</code></a></li>
<li class="chapter" data-level="3.3" data-path="3-data.html"><a href="3-data.html#sorting-observations-arrange"><i class="fa fa-check"></i><b>3.3</b> Sorting observations: <code>arrange()</code></a></li>
<li class="chapter" data-level="3.4" data-path="3-data.html"><a href="3-data.html#rename-variables-rename"><i class="fa fa-check"></i><b>3.4</b> Rename variables: <code>rename()</code></a></li>
<li class="chapter" data-level="3.5" data-path="3-data.html"><a href="3-data.html#create-variables-mutate"><i class="fa fa-check"></i><b>3.5</b> Create variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.6" data-path="3-data.html"><a href="3-data.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.6</b> The pipe operator: <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.7" data-path="3-data.html"><a href="3-data.html#running-functions-on-variables-apply"><i class="fa fa-check"></i><b>3.7</b> Running functions on variables: <code>apply()</code></a></li>
<li class="chapter" data-level="3.8" data-path="3-data.html"><a href="3-data.html#aggregating-variables-summarize-and-group_by"><i class="fa fa-check"></i><b>3.8</b> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></a></li>
<li class="chapter" data-level="3.9" data-path="3-data.html"><a href="3-data.html#recoding-variables-recode"><i class="fa fa-check"></i><b>3.9</b> Recoding variables: <code>recode()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-datadownload.html"><a href="4-datadownload.html"><i class="fa fa-check"></i><b>4</b> Get existing data</a><ul>
<li class="chapter" data-level="4.1" data-path="4-datadownload.html"><a href="4-datadownload.html#using-data-from-data-packages"><i class="fa fa-check"></i><b>4.1</b> Using data from data packages</a></li>
<li class="chapter" data-level="4.2" data-path="4-datadownload.html"><a href="4-datadownload.html#download-data-from-webpages"><i class="fa fa-check"></i><b>4.2</b> Download data from webpages</a></li>
<li class="chapter" data-level="4.3" data-path="4-datadownload.html"><a href="4-datadownload.html#data-european-social-survey-essurvey"><i class="fa fa-check"></i><b>4.3</b> Data: European Social Survey (<code>essurvey</code>)</a></li>
<li class="chapter" data-level="4.4" data-path="4-datadownload.html"><a href="4-datadownload.html#data-manifesto-project-dataset-manifestor"><i class="fa fa-check"></i><b>4.4</b> Data: Manifesto Project Dataset (<code>manifestoR</code>)</a></li>
<li class="chapter" data-level="4.5" data-path="4-datadownload.html"><a href="4-datadownload.html#data-varieties-of-democracy-vdem"><i class="fa fa-check"></i><b>4.5</b> Data: Varieties of Democracy (<code>vdem</code>)</a></li>
<li class="chapter" data-level="4.6" data-path="4-datadownload.html"><a href="4-datadownload.html#data-world-development-indicators-wdi"><i class="fa fa-check"></i><b>4.6</b> Data: World Development Indicators (<code>WDI</code>)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-create.html"><a href="5-create.html"><i class="fa fa-check"></i><b>5</b> Create data</a><ul>
<li class="chapter" data-level="5.1" data-path="5-create.html"><a href="5-create.html#create-data-from-files"><i class="fa fa-check"></i><b>5.1</b> Create data from files</a></li>
<li class="chapter" data-level="5.2" data-path="5-create.html"><a href="5-create.html#scrape-data-from-tables"><i class="fa fa-check"></i><b>5.2</b> Scrape data from tables</a></li>
<li class="chapter" data-level="5.3" data-path="5-create.html"><a href="5-create.html#scrape-political-speeches"><i class="fa fa-check"></i><b>5.3</b> Scrape political speeches</a></li>
<li class="chapter" data-level="5.4" data-path="5-create.html"><a href="5-create.html#get-data-from-twitter"><i class="fa fa-check"></i><b>5.4</b> Get data from Twitter</a><ul>
<li class="chapter" data-level="5.4.1" data-path="5-create.html"><a href="5-create.html#data-on-twitter-user"><i class="fa fa-check"></i><b>5.4.1</b> Data on Twitter user</a></li>
<li class="chapter" data-level="5.4.2" data-path="5-create.html"><a href="5-create.html#data-on-trends"><i class="fa fa-check"></i><b>5.4.2</b> Data on trends</a></li>
<li class="chapter" data-level="5.4.3" data-path="5-create.html"><a href="5-create.html#data-on-tweets"><i class="fa fa-check"></i><b>5.4.3</b> Data on tweets</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Presenting data</b></span></li>
<li class="chapter" data-level="6" data-path="6-dataviz.html"><a href="6-dataviz.html"><i class="fa fa-check"></i><b>6</b> Visualisation</a><ul>
<li class="chapter" data-level="6.1" data-path="6-dataviz.html"><a href="6-dataviz.html#the-basics-of-ggplot2"><i class="fa fa-check"></i><b>6.1</b> The basics of <code>ggplot2</code></a><ul>
<li class="chapter" data-level="6.1.1" data-path="3-data.html"><a href="3-data.html#data"><i class="fa fa-check"></i><b>6.1.1</b> Data</a></li>
<li class="chapter" data-level="6.1.2" data-path="6-dataviz.html"><a href="6-dataviz.html#aesthetics"><i class="fa fa-check"></i><b>6.1.2</b> Aesthetics</a></li>
<li class="chapter" data-level="6.1.3" data-path="6-dataviz.html"><a href="6-dataviz.html#geometric-objects"><i class="fa fa-check"></i><b>6.1.3</b> Geometric objects</a></li>
<li class="chapter" data-level="6.1.4" data-path="6-dataviz.html"><a href="6-dataviz.html#theme-adjustments"><i class="fa fa-check"></i><b>6.1.4</b> Theme adjustments</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-dataviz.html"><a href="6-dataviz.html#plotting-one-variable-distributions"><i class="fa fa-check"></i><b>6.2</b> Plotting one variable: distributions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="6-dataviz.html"><a href="6-dataviz.html#bar-plot"><i class="fa fa-check"></i><b>6.2.1</b> Bar plot</a></li>
<li class="chapter" data-level="6.2.2" data-path="6-dataviz.html"><a href="6-dataviz.html#histograms"><i class="fa fa-check"></i><b>6.2.2</b> Histograms</a></li>
<li class="chapter" data-level="6.2.3" data-path="6-dataviz.html"><a href="6-dataviz.html#density-plots"><i class="fa fa-check"></i><b>6.2.3</b> Density plots</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="6-dataviz.html"><a href="6-dataviz.html#plotting-two-variables-relationships"><i class="fa fa-check"></i><b>6.3</b> Plotting two variables: relationships</a><ul>
<li class="chapter" data-level="6.3.1" data-path="6-dataviz.html"><a href="6-dataviz.html#box-plot"><i class="fa fa-check"></i><b>6.3.1</b> Box plot</a></li>
<li class="chapter" data-level="6.3.2" data-path="6-dataviz.html"><a href="6-dataviz.html#scatter-plots"><i class="fa fa-check"></i><b>6.3.2</b> Scatter plots</a></li>
<li class="chapter" data-level="6.3.3" data-path="6-dataviz.html"><a href="6-dataviz.html#line-plots"><i class="fa fa-check"></i><b>6.3.3</b> Line plots</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="6-dataviz.html"><a href="6-dataviz.html#manipulating-plots"><i class="fa fa-check"></i><b>6.4</b> Manipulating plots</a><ul>
<li class="chapter" data-level="6.4.1" data-path="6-dataviz.html"><a href="6-dataviz.html#themes"><i class="fa fa-check"></i><b>6.4.1</b> Themes</a></li>
<li class="chapter" data-level="6.4.2" data-path="6-dataviz.html"><a href="6-dataviz.html#colours"><i class="fa fa-check"></i><b>6.4.2</b> Colours</a></li>
<li class="chapter" data-level="6.4.3" data-path="6-dataviz.html"><a href="6-dataviz.html#labels"><i class="fa fa-check"></i><b>6.4.3</b> Labels</a></li>
<li class="chapter" data-level="6.4.4" data-path="6-dataviz.html"><a href="6-dataviz.html#axes"><i class="fa fa-check"></i><b>6.4.4</b> Axes</a></li>
<li class="chapter" data-level="6.4.5" data-path="6-dataviz.html"><a href="6-dataviz.html#confidence-intervals"><i class="fa fa-check"></i><b>6.4.5</b> Confidence intervals</a></li>
<li class="chapter" data-level="6.4.6" data-path="6-dataviz.html"><a href="6-dataviz.html#making-multiple-plots-in-one"><i class="fa fa-check"></i><b>6.4.6</b> Making multiple plots in one</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="6-dataviz.html"><a href="6-dataviz.html#saving-plots"><i class="fa fa-check"></i><b>6.5</b> Saving plots</a></li>
</ul></li>
<li class="part"><span><b>III Regression</b></span></li>
<li class="chapter" data-level="7" data-path="7-olsreg.html"><a href="7-olsreg.html"><i class="fa fa-check"></i><b>7</b> OLS regression</a><ul>
<li class="chapter" data-level="7.1" data-path="7-olsreg.html"><a href="7-olsreg.html#bivariate-linear-regression"><i class="fa fa-check"></i><b>7.1</b> Bivariate linear regression</a></li>
<li class="chapter" data-level="7.2" data-path="7-olsreg.html"><a href="7-olsreg.html#multiple-linear-regression"><i class="fa fa-check"></i><b>7.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="7.3" data-path="7-olsreg.html"><a href="7-olsreg.html#diagnostic-tests"><i class="fa fa-check"></i><b>7.3</b> Diagnostic tests</a></li>
<li class="chapter" data-level="7.4" data-path="7-olsreg.html"><a href="7-olsreg.html#setting-up-regression-tables"><i class="fa fa-check"></i><b>7.4</b> Setting up regression tables</a><ul>
<li class="chapter" data-level="7.4.1" data-path="7-olsreg.html"><a href="7-olsreg.html#exporting-the-regression-table"><i class="fa fa-check"></i><b>7.4.1</b> Exporting the regression table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-references.html"><a href="8-references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Politics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="create" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Create data</h1>
<p>In this chapter we will introduce different ways to create your own data. Specifically, we will show how to create data from existing files, how to scrape tables from webpages and how to get data from Twitter.</p>
<div id="create-data-from-files" class="section level2">
<h2><span class="header-section-number">5.1</span> Create data from files</h2>
<p>You will often encounter that the data of interest is not available in a format or structure that you will need for your analysis. Accordingly, as a first step, you will need to collect multiple files and turn them into a single dataset.</p>
<p>Here, we will use the example of election results from the Electoral Calculus. The example is from Matt Riggott (see the script <a href="https://github.com/flother/british-party-support/blob/master/british-party-support.R">here</a>) and shows how we can download multiple files and connect them into a single dataset. Each file we will work with contains the election results from general elections in the UK.</p>
<p>As always, the first thing we will do is to load the <code>tidyverse</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>Next, to get a sense of the data we will be looking at, go to your browser (e.g.Â Google Chrome or Safari) and open this link: <a href="https://www.electoralcalculus.co.uk/electdata_1955.txt" class="uri">https://www.electoralcalculus.co.uk/electdata_1955.txt</a></p>
<p>In this file, you will see multiple lines. These are the election results from 1955 (as indicated by the filename, <code>electdata_1955.txt</code>. The first line in the file is: <code>Name;MP;Area;County;Electorate;CON;LAB;LIB;NAT;MIN;OTH</code>. These are the variable names and are separated by <code>;</code>. By using the function <code>read_delim()</code> from the <code>tidyverse</code> package, we can load this file into <code>R</code> as a data frame. Notice that we specify that <code>;</code> is used to separate fields. We save the file in the object <code>el_1955</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">el_<span class="dv">1955</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(
  <span class="st">&quot;https://www.electoralcalculus.co.uk/electdata_1955.txt&quot;</span>, 
  <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>
  )</code></pre></div>
<p>To inspect the data, we can use the function <code>head()</code> (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(el_<span class="dv">1955</span>)</code></pre></div>
<p>The above output shows that the data is loaded succesfully and saved in a data frame. We could do this for all elections manually, but that would take a lot of time and increase the odds of making mistakes. Instead, we will create a function that downloads all files. First, we specify the elections we are interested in (from 1955 to 2017) and save this information in the object <code>election_years</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">election_years &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1959&quot;</span>, <span class="st">&quot;1964&quot;</span>, <span class="st">&quot;1966&quot;</span>, <span class="st">&quot;1970&quot;</span>, <span class="st">&quot;1974feb&quot;</span>,
<span class="st">&quot;1974oct&quot;</span>, <span class="st">&quot;1979&quot;</span>, <span class="st">&quot;1983&quot;</span>, <span class="st">&quot;1987&quot;</span>, <span class="st">&quot;1992ob&quot;</span>, <span class="st">&quot;1997&quot;</span>,
<span class="st">&quot;2001ob&quot;</span>, <span class="st">&quot;2005ob&quot;</span>, <span class="st">&quot;2010&quot;</span>, <span class="st">&quot;2015&quot;</span>, <span class="st">&quot;2017&quot;</span>)</code></pre></div>
<p>Second, we use <code>read_delim()</code> again, but as part as a function where we use the <code>read_delim()</code> on the year we specify. We call this function <code>read_election_data()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_election_data &lt;-<span class="st"> </span><span class="cf">function</span>(election) {
  url &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;http://www.electoralcalculus.co.uk/electdata_&quot;</span>, 
                election, <span class="st">&quot;.txt&quot;</span>)
  <span class="kw">read_delim</span>(url, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> election)
}</code></pre></div>
<p>With this function, we can specify any election year and get the data, e.g. <code>read_election_data(2017)</code> to get the data from 2017. Here, we use <code>lapply()</code> to run the function on all the election years mentioned in the object <code>election_years</code> above. To connect all elections, we use the function <code>bind_rows()</code>. We save the output in the object <code>elections</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">elections &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">lapply</span>(election_years, read_election_data))</code></pre></div>
<p>To see whether it has worked, use <code>head()</code> on the object (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(elections)</code></pre></div>
</div>
<div id="scrape-data-from-tables" class="section level2">
<h2><span class="header-section-number">5.2</span> Scrape data from tables</h2>
<p>To scrape data from tables online, we use the <code>rvest</code> package. Remember to install it if you havenât already done so.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rvest&quot;</span>)</code></pre></div>
<p>In the example below, we will show how to easily scrape a table from a Wikipedia page. The first thing we do is to specify the link to the Wikipedia page and save it in the object <code>url</code>. In the example we will be looking at the election results from the 2014 European Parliament election in the United Kingdom.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;https://en.wikipedia.org/wiki/European_Parliament_election,_2014_(United_Kingdom)&quot;</span>
  )</code></pre></div>
<p>Next, we use the <code>read_html()</code> function to save the content on the Wikipedia page. We save the data in the object <code>wikipage</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wikipage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</code></pre></div>
<p>We can use the function <code>class()</code> to see what type of content we have in the object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(wikipage)</code></pre></div>
<p>Here, we see that we have an xml_document and xml_node in our object. We want to save the tables in our data. To do this, we use the function <code>html_nodes()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_table &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(wikipage, <span class="st">&quot;table&quot;</span>)</code></pre></div>
<p>If you type <code>data_table</code>, you can see an overview of all the tables we have saved. Here, we would like to use the data on the number of votes the different parties got in the 2014 European Parliament election in the United Kingdom. We can see that this table is number 14 in our object. We save this table in the object <code>data_results</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_results &lt;-<span class="st"> </span>data_table[[<span class="dv">14</span>]] </code></pre></div>
<p>We can now use the function <code>html_table()</code> to save the table as a data frame. We use the option <code>fill=TRUE</code> as there are empty cells in the table. We save the table in the object <code>ep14_raw</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span><span class="kw">html_table</span>(data_results, <span class="dt">fill=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>To ensure that it is a data frame we are working with, we can use the function <code>class()</code> again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(ep14_raw)</code></pre></div>
<p>We call the object <code>ep14_raw</code> as it is a raw table that needs further changes before we are satisfied. To get a sense of one of the issues with the data frame, we look at the last observations in the data frame with <code>tail()</code> (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(ep14_raw)</code></pre></div>
<p>Here we see that the last three rows are aggregated numbers unrelated to the votes for the individual parties. Accordingly, we would like to remove these observations. To remove the specific rows, we save the object without observations 32, 33 and 34.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw[<span class="op">-</span><span class="kw">c</span>(<span class="dv">32</span><span class="op">:</span><span class="dv">34</span>), ]</code></pre></div>
<p>Next, we use <code>head()</code> to see what our data frame looks like for the first observations (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ep14_raw)</code></pre></div>
<p>We see two main issues. First, that the variable names are not unique and will need to be changed. We are interested in four of the variables, namely the name of the party, the number of votes, the vote share and the number of seats. We give the relevant variables names and give the other variables unimportant names (as we are going to ignore those).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(ep14_raw) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;party&quot;</span>, <span class="st">&quot;votes&quot;</span>, <span class="st">&quot;share&quot;</span>, <span class="st">&quot;V5&quot;</span>, 
                     <span class="st">&quot;seats&quot;</span>, <span class="st">&quot;V7&quot;</span>, <span class="st">&quot;V8&quot;</span>, <span class="st">&quot;V9&quot;</span>, <span class="st">&quot;V10&quot;</span>)</code></pre></div>
<p>Next, we can see that the first row is not an observation but variable names as well. Accordingly, we need to remove this observation as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>), ]</code></pre></div>
<p>To remove the irrelevant variables in our data frame, we use the <code>select()</code> function to select the relevant variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(party, votes, share, seats)</code></pre></div>
<p>The last thing to do is to tell <code>R</code> that three variables, <code>votes</code>, <code>share</code> and <code>seats</code> are numeric. Notice how we use the function <code>gsub()</code> to get rid of commas. We save this data frame in the object <code>ep14</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14 &lt;-<span class="st"> </span>ep14_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">votes =</span> <span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>, votes)),
    <span class="dt">share =</span> <span class="kw">as.numeric</span>(share),
    <span class="dt">seats =</span> <span class="kw">as.numeric</span>(seats)
  )</code></pre></div>
<p>Inspect the final data frame. In this case, we do not have a lot of observations and we simply show them all.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14</code></pre></div>
<p>Last, we create a figure showing the vote share and seats for the parties (notice that you will also need the package <code>ggrepel</code> to create the figure). (Output not shown)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ep14, <span class="kw">aes</span>(<span class="dt">x =</span> share, <span class="dt">y =</span> seats)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(
    <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">ifelse</span>(share <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>, party, <span class="ot">NA</span>)),
      <span class="dt">size =</span> <span class="fl">4.5</span>,
      <span class="dt">point.padding =</span> .<span class="dv">2</span>,
      <span class="dt">box.padding =</span> .<span class="dv">4</span>
    ) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&quot;Number of seats&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;Vote share&quot;</span>,
    <span class="dt">title =</span> <span class="st">&quot;2014 European Parliament election, United Kingdom&quot;</span>
  )</code></pre></div>
</div>
<div id="scrape-political-speeches" class="section level2">
<h2><span class="header-section-number">5.3</span> Scrape political speeches</h2>
<p>A lot of the text we can scrape online is not in the form of spreadsheets but in the form of nothing but text. To show how to scrape such text, we will focus on British political speeches from <a href="http://www.britishpoliticalspeech.org/speech-archive.htm" class="uri">http://www.britishpoliticalspeech.org/speech-archive.htm</a>.</p>
<p>Specifically, we will select the speech the Leaderâs speech by Theresa May in Manchester from 2017. First, as in the previous example, we specify the url of the page we would like to scrape. In this speech, Theresa May is talking extensively about the British Dream.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;http://www.britishpoliticalspeech.org/speech-archive.htm?speech=367&quot;</span>
  )</code></pre></div>
<p>To get the content of the page with the speech, we save the content of the page in the object <code>speechpage</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">speechpage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</code></pre></div>
<p>Next, to select the actual part of the page containing the speech, we select the content within the <code>&lt;p&gt;&lt;/p&gt;</code> tags.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(speechpage, <span class="st">&quot;p&quot;</span>)</code></pre></div>
<p>To get the actual text, we use the function <code>html_text()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech_text &lt;-<span class="st"> </span><span class="kw">html_text</span>(data_speech)</code></pre></div>
<p>Now we have all the text we need to use. However, to create a dataset with the words in the speech, we will use some functions from the package <code>tidytext</code> (as always, remember to install the package if you do not already have it installed) <span class="citation">(Silge &amp; Robinson, 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidytext&quot;</span>)</code></pre></div>
<p>The first function we are going to use is not part of the package but will be used to convert our speech into a data frame using the <code>data_frame()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">text =</span> data_speech_text)</code></pre></div>
<p>While in a data frame, it is still just a lot of sentences on different rows. To unnest all the sentences in our text column into a word column, we use the function <code>unnest_tokens()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words &lt;-<span class="st"> </span>data_speech_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest_tokens</span>(word, text)</code></pre></div>
<p>This gives us an object, <code>words</code>, with 7,116 observations. However, a lot of these words are irrelevant stop words (most common words that we are not interested in such as <em>the</em>, <em>is</em>, <em>at</em>, <em>which</em>) that we would like to remove. We use the <code>anti_join()</code> function to remove all stop words.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words &lt;-<span class="st"> </span>words <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">anti_join</span>(stop_words, <span class="dt">by =</span> <span class="st">&quot;word&quot;</span>)</code></pre></div>
<p>Last, we can count the words in the speech and calculate the number of occurrences.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>We see that <em>people</em> is mentioned 49 times, and <em>britain</em> is mentioned 36 times. <em>dream</em> and <em>british</em> are mentioned 33 and 29 times, respectively.</p>
</div>
<div id="get-data-from-twitter" class="section level2">
<h2><span class="header-section-number">5.4</span> Get data from Twitter</h2>
<p>To get data from Twitter, we are going to use the <code>rtweet</code> package <span class="citation">(Kearney, 2018)</span>. The first thing we do is to load the package (remember to install if if you have not already done so). You can find more information about the package here: <a href="https://rtweet.info/" class="uri">https://rtweet.info/</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rtweet&quot;</span>)</code></pre></div>
<p>Next, to make sure you can collect data, you need to have a Twitter user. You can register for free at <a href="https://twitter.com/" class="uri">https://twitter.com/</a>. You will need this in order to use the <code>rstats2twitter</code> app. Last, make sure to install the <code>httpuv</code> package as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;httpuv&quot;</span>)</code></pre></div>
<p>Noteworthy, we cannot just collect data without any limits. In most cases, we have a liit of 18,000 observations per 15 minutes.</p>
<div id="data-on-twitter-user" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Data on Twitter user</h3>
<p>To get data on a Twitter user, we can use different functions. There is a distinction betweeen friends and followers. The accounts a user follows are called friends, whereas followers are the accounts that follow a user. Here, we will use the <code>get_friends()</code> function to get information on the people Donald Trump is following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_following &lt;-<span class="st"> </span><span class="kw">get_friends</span>(<span class="st">&quot;realDonaldTrump&quot;</span>)</code></pre></div>
<p>When we do that, all we get is a series of user IDs for the people Donald Trump is following. We can use the <code>lookup_users()</code> function toget more information about the individual accounts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_following &lt;-<span class="st"> </span><span class="kw">lookup_users</span>(trump_following<span class="op">$</span>user_id)</code></pre></div>
<p>This gives us a lot more information on the individual users, including their Twitter handle, name and description. To see all the information saved, you can use the <code>names()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(trump_following)</code></pre></div>
<p>To save information on the user ID, the handle, name and the description, we create a new object called <code>trump_data</code> just with these variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_data &lt;-<span class="st"> </span>trump_following <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(user_id, screen_name, name, description) </code></pre></div>
<p>You can use <code>head(trump_data)</code> to see what the data looks like. To get information on the followers of Donald Trump, you can use the <code>get_followers()</code> function. However, this will take a lot of time to get (we are talking days!).</p>
<p>To get the most recent tweets from, Donald Trump, we can use the <code>get_timeline()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_tweets &lt;-<span class="st"> </span><span class="kw">get_timeline</span>(<span class="st">&quot;realDonaldTrump&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>)</code></pre></div>
<p>To search for tweets from specific users, we can use the <code>search_users()</code> function. Below, we search for tweets from users with <code>politics</code> (via Twitters search query).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">politics_users &lt;-<span class="st"> </span><span class="kw">search_users</span>(<span class="st">&quot;politics&quot;</span>, <span class="dt">n =</span> <span class="dv">50</span>)</code></pre></div>
<p>Next, we can use the <code>get_favorites()</code> function to get data on the tweets a user has favorited. Here, we save the favorites from Boris Johnson and save it in the object <code>tweets_bj</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tweets_bj &lt;-<span class="st"> </span><span class="kw">get_favorites</span>(<span class="st">&quot;BorisJohnson&quot;</span>)</code></pre></div>
<p>To get a sense of what this data looks like, you can use the <code>head()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tweets_bj)</code></pre></div>
</div>
<div id="data-on-trends" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Data on trends</h3>
<p>To get data on what is trending in a certain part of the world, we can use the <code>get_trends()</code> function. Below, we get the 50 most trending topics in the United Kingdom. On October 29, 2018, <code>#NationalCatDay</code> and <code>Angela Merkel</code> are both trending (not for the same reason though).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trends_uk &lt;-<span class="st"> </span><span class="kw">get_trends</span>(<span class="st">&quot;united kingdom&quot;</span>)</code></pre></div>
</div>
<div id="data-on-tweets" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Data on tweets</h3>
<p>Last, to get data on specific tweets, we first use the <code>search_tweets()</code> function. Below, we get the most recent 100 tweets mentioning <code>brexit</code>. We also specify that we are not interested in retweets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">brexit &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(
  <span class="st">&quot;brexit&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>This gives us a data frame with 100 observations and 88 variables. You can use the <code>names()</code> function to get a list of all variables in the data frame.</p>
<p>You can also use the search operators provided by Twitter, e.g.Â by filtering only tweets linking to news articles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">news &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;filter:news&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>)</code></pre></div>
<p>We acn combine the two searches above and only search for tweets with Brexit related news.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">brexit_news &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;brexit filter:news&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>If we want to only include tweets with a video, we can use <code>&quot;filter:video&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">videos &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;filter:video&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>To look up data on a specific tweet, use the function <code>lookup_tweets()</code>. You can find the id on a tweet by looking in the url for a tweet (or in the variable <code>status_id</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lookup_tweets</span>(<span class="st">&quot;1065623990746710022&quot;</span>)</code></pre></div>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="4-datadownload.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-dataviz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["qpolr.pdf", "PDF"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
