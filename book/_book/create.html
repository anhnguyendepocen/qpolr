<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Create data | Quantitative Politics with R</title>
  <meta name="description" content="Chapter 6 Create data | Quantitative Politics with R" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Create data | Quantitative Politics with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://qpolr.com" />
  
  
  <meta name="github-repo" content="erikgahner/qpolr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Create data | Quantitative Politics with R" />
  
  
  

<meta name="author" content="Erik Gahner Larsen and ZoltÃ¡n Fazekas" />


<meta name="date" content="2019-11-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="datadownload.html"/>
<link rel="next" href="dataviz.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why <code>R</code>?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installing-r"><i class="fa fa-check"></i><b>1.2</b> Installing <code>R</code></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#installing-rstudio"><i class="fa fa-check"></i><b>1.3</b> Installing RStudio</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#installing-r-packages"><i class="fa fa-check"></i><b>1.4</b> Installing <code>R</code> packages</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#problems-and-help"><i class="fa fa-check"></i><b>1.5</b> Problems and help</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Basics</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#numbers-as-data"><i class="fa fa-check"></i><b>2.1</b> Numbers as data</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#missing-values-na"><i class="fa fa-check"></i><b>2.2</b> Missing values (<code>NA</code>)</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#logical-operators"><i class="fa fa-check"></i><b>2.3</b> Logical operators</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#text-as-data"><i class="fa fa-check"></i><b>2.4</b> Text as data</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#data-frames"><i class="fa fa-check"></i><b>2.5</b> Data frames</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#import-and-export-data-frames"><i class="fa fa-check"></i><b>2.6</b> Import and export data frames</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#environment"><i class="fa fa-check"></i><b>2.7</b> Environment</a></li>
</ul></li>
<li class="part"><span><b>I Working with data</b></span></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data management</a><ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#selecting-variables-select"><i class="fa fa-check"></i><b>3.1</b> Selecting variables: <code>select()</code></a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#selecting-observations-filter"><i class="fa fa-check"></i><b>3.2</b> Selecting observations: <code>filter()</code></a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#sorting-observations-arrange"><i class="fa fa-check"></i><b>3.3</b> Sorting observations: <code>arrange()</code></a></li>
<li class="chapter" data-level="3.4" data-path="data.html"><a href="data.html#rename-variables-rename"><i class="fa fa-check"></i><b>3.4</b> Rename variables: <code>rename()</code></a></li>
<li class="chapter" data-level="3.5" data-path="data.html"><a href="data.html#create-variables-mutate"><i class="fa fa-check"></i><b>3.5</b> Create variables: <code>mutate()</code></a></li>
<li class="chapter" data-level="3.6" data-path="data.html"><a href="data.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.6</b> The pipe operator: <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.7" data-path="data.html"><a href="data.html#running-functions-on-variables-apply"><i class="fa fa-check"></i><b>3.7</b> Running functions on variables: <code>apply()</code></a></li>
<li class="chapter" data-level="3.8" data-path="data.html"><a href="data.html#aggregating-variables-summarize-and-group_by"><i class="fa fa-check"></i><b>3.8</b> Aggregating variables: <code>summarize()</code> and <code>group_by()</code></a></li>
<li class="chapter" data-level="3.9" data-path="data.html"><a href="data.html#recoding-variables-case_when"><i class="fa fa-check"></i><b>3.9</b> Recoding variables: <code>case_when()</code></a></li>
<li class="chapter" data-level="3.10" data-path="data.html"><a href="data.html#getting-a-variable-from-a-data-frame-pull"><i class="fa fa-check"></i><b>3.10</b> Getting a variable from a data frame: <code>pull()</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="text.html"><a href="text.html"><i class="fa fa-check"></i><b>4</b> Manipulating text</a><ul>
<li class="chapter" data-level="4.1" data-path="text.html"><a href="text.html#strings"><i class="fa fa-check"></i><b>4.1</b> Strings</a></li>
<li class="chapter" data-level="4.2" data-path="text.html"><a href="text.html#factors"><i class="fa fa-check"></i><b>4.2</b> Factors</a></li>
<li class="chapter" data-level="4.3" data-path="text.html"><a href="text.html#dates-and-time"><i class="fa fa-check"></i><b>4.3</b> Dates and time</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datadownload.html"><a href="datadownload.html"><i class="fa fa-check"></i><b>5</b> Get existing data</a><ul>
<li class="chapter" data-level="5.1" data-path="datadownload.html"><a href="datadownload.html#using-data-from-data-packages"><i class="fa fa-check"></i><b>5.1</b> Using data from data packages</a></li>
<li class="chapter" data-level="5.2" data-path="datadownload.html"><a href="datadownload.html#download-data-from-webpages"><i class="fa fa-check"></i><b>5.2</b> Download data from webpages</a></li>
<li class="chapter" data-level="5.3" data-path="datadownload.html"><a href="datadownload.html#data-european-social-survey-essurvey"><i class="fa fa-check"></i><b>5.3</b> Data: European Social Survey (<code>essurvey</code>)</a></li>
<li class="chapter" data-level="5.4" data-path="datadownload.html"><a href="datadownload.html#data-general-social-survey-gssr"><i class="fa fa-check"></i><b>5.4</b> Data: General Social Survey (<code>gssr</code>)</a></li>
<li class="chapter" data-level="5.5" data-path="datadownload.html"><a href="datadownload.html#data-american-national-election-study-anesr"><i class="fa fa-check"></i><b>5.5</b> Data: American National Election Study (<code>anesr</code>)</a></li>
<li class="chapter" data-level="5.6" data-path="datadownload.html"><a href="datadownload.html#data-manifesto-project-dataset-manifestor"><i class="fa fa-check"></i><b>5.6</b> Data: Manifesto Project Dataset (<code>manifestoR</code>)</a></li>
<li class="chapter" data-level="5.7" data-path="datadownload.html"><a href="datadownload.html#data-varieties-of-democracy-vdem"><i class="fa fa-check"></i><b>5.7</b> Data: Varieties of Democracy (<code>vdem</code>)</a></li>
<li class="chapter" data-level="5.8" data-path="datadownload.html"><a href="datadownload.html#data-world-development-indicators-wdi"><i class="fa fa-check"></i><b>5.8</b> Data: World Development Indicators (<code>WDI</code>)</a></li>
<li class="chapter" data-level="5.9" data-path="datadownload.html"><a href="datadownload.html#data-github-repositories"><i class="fa fa-check"></i><b>5.9</b> Data: GitHub repositories</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="create.html"><a href="create.html"><i class="fa fa-check"></i><b>6</b> Create data</a><ul>
<li class="chapter" data-level="6.1" data-path="create.html"><a href="create.html#create-data-from-files"><i class="fa fa-check"></i><b>6.1</b> Create data from files</a></li>
<li class="chapter" data-level="6.2" data-path="create.html"><a href="create.html#scrape-data-from-tables"><i class="fa fa-check"></i><b>6.2</b> Scrape data from tables</a></li>
<li class="chapter" data-level="6.3" data-path="create.html"><a href="create.html#scrape-political-speeches"><i class="fa fa-check"></i><b>6.3</b> Scrape political speeches</a></li>
<li class="chapter" data-level="6.4" data-path="create.html"><a href="create.html#get-data-from-twitter"><i class="fa fa-check"></i><b>6.4</b> Get data from Twitter</a><ul>
<li class="chapter" data-level="6.4.1" data-path="create.html"><a href="create.html#data-on-twitter-user"><i class="fa fa-check"></i><b>6.4.1</b> Data on Twitter user</a></li>
<li class="chapter" data-level="6.4.2" data-path="create.html"><a href="create.html#data-on-trends"><i class="fa fa-check"></i><b>6.4.2</b> Data on trends</a></li>
<li class="chapter" data-level="6.4.3" data-path="create.html"><a href="create.html#data-on-tweets"><i class="fa fa-check"></i><b>6.4.3</b> Data on tweets</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="create.html"><a href="create.html#get-data-from-google-trends"><i class="fa fa-check"></i><b>6.5</b> Get data from Google Trends</a></li>
<li class="chapter" data-level="6.6" data-path="create.html"><a href="create.html#get-data-from-wikipedia"><i class="fa fa-check"></i><b>6.6</b> Get data from Wikipedia</a></li>
</ul></li>
<li class="part"><span><b>II Data visualisation</b></span></li>
<li class="chapter" data-level="7" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>7</b> Introduction to <code>ggplot2</code></a><ul>
<li class="chapter" data-level="7.1" data-path="dataviz.html"><a href="dataviz.html#the-basics-of-ggplot2"><i class="fa fa-check"></i><b>7.1</b> The basics of <code>ggplot2</code></a></li>
<li class="chapter" data-level="7.2" data-path="data.html"><a href="data.html#data"><i class="fa fa-check"></i><b>7.2</b> Data</a></li>
<li class="chapter" data-level="7.3" data-path="dataviz.html"><a href="dataviz.html#aesthetics"><i class="fa fa-check"></i><b>7.3</b> Aesthetics</a></li>
<li class="chapter" data-level="7.4" data-path="dataviz.html"><a href="dataviz.html#geometric-objects"><i class="fa fa-check"></i><b>7.4</b> Geometric objects</a></li>
<li class="chapter" data-level="7.5" data-path="dataviz.html"><a href="dataviz.html#theme-adjustments"><i class="fa fa-check"></i><b>7.5</b> Theme adjustments</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="presenting-distributions.html"><a href="presenting-distributions.html"><i class="fa fa-check"></i><b>8</b> Presenting distributions</a><ul>
<li class="chapter" data-level="8.1" data-path="presenting-distributions.html"><a href="presenting-distributions.html#bar-plot"><i class="fa fa-check"></i><b>8.1</b> Bar plot</a></li>
<li class="chapter" data-level="8.2" data-path="presenting-distributions.html"><a href="presenting-distributions.html#histograms"><i class="fa fa-check"></i><b>8.2</b> Histograms</a></li>
<li class="chapter" data-level="8.3" data-path="presenting-distributions.html"><a href="presenting-distributions.html#density-plots"><i class="fa fa-check"></i><b>8.3</b> Density plots</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="presenting-relationships.html"><a href="presenting-relationships.html"><i class="fa fa-check"></i><b>9</b> Presenting relationships</a><ul>
<li class="chapter" data-level="9.1" data-path="presenting-relationships.html"><a href="presenting-relationships.html#box-plot"><i class="fa fa-check"></i><b>9.1</b> Box plot</a></li>
<li class="chapter" data-level="9.2" data-path="presenting-relationships.html"><a href="presenting-relationships.html#scatter-plots"><i class="fa fa-check"></i><b>9.2</b> Scatter plots</a></li>
<li class="chapter" data-level="9.3" data-path="presenting-relationships.html"><a href="presenting-relationships.html#line-plots"><i class="fa fa-check"></i><b>9.3</b> Line plots</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="manipulating-plots.html"><a href="manipulating-plots.html"><i class="fa fa-check"></i><b>10</b> Manipulating plots</a><ul>
<li class="chapter" data-level="10.1" data-path="manipulating-plots.html"><a href="manipulating-plots.html#themes"><i class="fa fa-check"></i><b>10.1</b> Themes</a></li>
<li class="chapter" data-level="10.2" data-path="manipulating-plots.html"><a href="manipulating-plots.html#colours"><i class="fa fa-check"></i><b>10.2</b> Colours</a></li>
<li class="chapter" data-level="10.3" data-path="manipulating-plots.html"><a href="manipulating-plots.html#labels"><i class="fa fa-check"></i><b>10.3</b> Labels</a></li>
<li class="chapter" data-level="10.4" data-path="manipulating-plots.html"><a href="manipulating-plots.html#axes"><i class="fa fa-check"></i><b>10.4</b> Axes</a></li>
<li class="chapter" data-level="10.5" data-path="manipulating-plots.html"><a href="manipulating-plots.html#confidence-intervals"><i class="fa fa-check"></i><b>10.5</b> Confidence intervals</a></li>
<li class="chapter" data-level="10.6" data-path="manipulating-plots.html"><a href="manipulating-plots.html#making-multiple-plots-in-one"><i class="fa fa-check"></i><b>10.6</b> Making multiple plots in one</a></li>
<li class="chapter" data-level="10.7" data-path="manipulating-plots.html"><a href="manipulating-plots.html#saving-plots"><i class="fa fa-check"></i><b>10.7</b> Saving plots</a></li>
</ul></li>
<li class="part"><span><b>III Regression</b></span></li>
<li class="chapter" data-level="11" data-path="olsreg.html"><a href="olsreg.html"><i class="fa fa-check"></i><b>11</b> OLS regression</a><ul>
<li class="chapter" data-level="11.1" data-path="olsreg.html"><a href="olsreg.html#bivariate-linear-regression"><i class="fa fa-check"></i><b>11.1</b> Bivariate linear regression</a></li>
<li class="chapter" data-level="11.2" data-path="olsreg.html"><a href="olsreg.html#multiple-linear-regression"><i class="fa fa-check"></i><b>11.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="11.3" data-path="olsreg.html"><a href="olsreg.html#saving-predictions"><i class="fa fa-check"></i><b>11.3</b> Saving predictions</a></li>
<li class="chapter" data-level="11.4" data-path="olsreg.html"><a href="olsreg.html#diagnostic-tests"><i class="fa fa-check"></i><b>11.4</b> Diagnostic tests</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>12</b> Generalized linear models</a><ul>
<li class="chapter" data-level="12.1" data-path="glm.html"><a href="glm.html#binary-outcomes"><i class="fa fa-check"></i><b>12.1</b> Binary outcomes</a></li>
<li class="chapter" data-level="12.2" data-path="glm.html"><a href="glm.html#other-models"><i class="fa fa-check"></i><b>12.2</b> Other models</a><ul>
<li class="chapter" data-level="12.2.1" data-path="glm.html"><a href="glm.html#event-count"><i class="fa fa-check"></i><b>12.2.1</b> Event count</a></li>
<li class="chapter" data-level="12.2.2" data-path="glm.html"><a href="glm.html#negative-binomial-regression"><i class="fa fa-check"></i><b>12.2.2</b> Negative binomial regression</a></li>
<li class="chapter" data-level="12.2.3" data-path="glm.html"><a href="glm.html#ordinal-outcomes"><i class="fa fa-check"></i><b>12.2.3</b> Ordinal outcomes</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Presentation</b></span></li>
<li class="chapter" data-level="13" data-path="writing.html"><a href="writing.html"><i class="fa fa-check"></i><b>13</b> Writing</a><ul>
<li class="chapter" data-level="13.1" data-path="writing.html"><a href="writing.html#equations"><i class="fa fa-check"></i><b>13.1</b> Equations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>14</b> Tables</a><ul>
<li class="chapter" data-level="14.1" data-path="tables.html"><a href="tables.html#regression-tables"><i class="fa fa-check"></i><b>14.1</b> Regression tables</a><ul>
<li class="chapter" data-level="14.1.1" data-path="tables.html"><a href="tables.html#exporting-the-regression-table"><i class="fa fa-check"></i><b>14.1.1</b> Exporting the regression table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>15</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Politics with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="create" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Create data</h1>
<p>In this chapter we will introduce different ways to create your own data. Specifically, we will show how to create data from existing files, how to scrape tables from webpages and how to get data from Twitter.</p>
<div id="create-data-from-files" class="section level2">
<h2><span class="header-section-number">6.1</span> Create data from files</h2>
<p>You will often encounter that the data of interest is not available in a format or structure that you will need for your analysis. Accordingly, as a first step, you will need to collect multiple files and turn them into a single dataset.</p>
<p>Here, we will use the example of election results from the Electoral Calculus. The example is from Matt Riggott (see the script <a href="https://github.com/flother/british-party-support/blob/master/british-party-support.R">here</a>) and shows how we can download multiple files and connect them into a single dataset. Each file we will work with contains the election results from general elections in the UK.</p>
<p>As always, the first thing we will do is to load the <code>tidyverse</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>Next, to get a sense of the data we will be looking at, go to your browser (e.g.Â Google Chrome or Safari) and open this link: <a href="https://www.electoralcalculus.co.uk/electdata_1955.txt" class="uri">https://www.electoralcalculus.co.uk/electdata_1955.txt</a></p>
<p>In this file, you will see multiple lines. These are the election results from 1955 (as indicated by the filename, <code>electdata_1955.txt</code>. The first line in the file is: <code>Name;MP;Area;County;Electorate;CON;LAB;LIB;NAT;MIN;OTH</code>. These are the variable names and are separated by <code>;</code>. By using the function <code>read_delim()</code> from the <code>tidyverse</code> package, we can load this file into <code>R</code> as a data frame. Notice that we specify that <code>;</code> is used to separate fields. We save the file in the object <code>el_1955</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">el_<span class="dv">1955</span> &lt;-<span class="st"> </span><span class="kw">read_delim</span>(
  <span class="st">&quot;https://www.electoralcalculus.co.uk/electdata_1955.txt&quot;</span>, 
  <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>
  )</code></pre></div>
<p>To inspect the data, we can use the function <code>head()</code> (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(el_<span class="dv">1955</span>)</code></pre></div>
<p>The above output shows that the data is loaded succesfully and saved in a data frame. We could do this for all elections manually, but that would take a lot of time and increase the odds of making mistakes. Instead, we will create a function that downloads all files. First, we specify the elections we are interested in (from 1955 to 2017) and save this information in the object <code>election_years</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">election_years &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1955&quot;</span>, <span class="st">&quot;1959&quot;</span>, <span class="st">&quot;1964&quot;</span>, <span class="st">&quot;1966&quot;</span>, <span class="st">&quot;1970&quot;</span>, <span class="st">&quot;1974feb&quot;</span>,
<span class="st">&quot;1974oct&quot;</span>, <span class="st">&quot;1979&quot;</span>, <span class="st">&quot;1983&quot;</span>, <span class="st">&quot;1987&quot;</span>, <span class="st">&quot;1992ob&quot;</span>, <span class="st">&quot;1997&quot;</span>,
<span class="st">&quot;2001ob&quot;</span>, <span class="st">&quot;2005ob&quot;</span>, <span class="st">&quot;2010&quot;</span>, <span class="st">&quot;2015&quot;</span>, <span class="st">&quot;2017&quot;</span>)</code></pre></div>
<p>Second, we use <code>read_delim()</code> again, but as part as a function where we use the <code>read_delim()</code> on the year we specify. We call this function <code>read_election_data()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">read_election_data &lt;-<span class="st"> </span><span class="cf">function</span>(election) {
  url &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;http://www.electoralcalculus.co.uk/electdata_&quot;</span>, 
                election, <span class="st">&quot;.txt&quot;</span>)
  <span class="kw">read_delim</span>(url, <span class="dt">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> election)
}</code></pre></div>
<p>With this function, we can specify any election year and get the data, e.g. <code>read_election_data(2017)</code> to get the data from 2017. Here, we use <code>lapply()</code> to run the function on all the election years mentioned in the object <code>election_years</code> above. To connect all elections, we use the function <code>bind_rows()</code>. We save the output in the object <code>elections</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">elections &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="kw">lapply</span>(election_years, read_election_data))</code></pre></div>
<p>To see whether it has worked, use <code>head()</code> on the object (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(elections)</code></pre></div>
</div>
<div id="scrape-data-from-tables" class="section level2">
<h2><span class="header-section-number">6.2</span> Scrape data from tables</h2>
<p>To scrape data from tables online, we use the <code>rvest</code> package. Remember to install it if you havenât already done so.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rvest&quot;</span>)</code></pre></div>
<p>In the example below, we will show how to easily scrape a table from a Wikipedia page. The first thing we do is to specify the link to the Wikipedia page and save it in the object <code>url</code>. In the example we will be looking at the election results from the 2014 European Parliament election in the United Kingdom.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;https://en.wikipedia.org/wiki/2014_European_Parliament_election_in_the_United_Kingdom&quot;</span>
  )</code></pre></div>
<p>Next, we use the <code>read_html()</code> function to save the content on the Wikipedia page. We save the data in the object <code>wikipage</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wikipage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</code></pre></div>
<p>We can use the function <code>class()</code> to see what type of content we have in the object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(wikipage)</code></pre></div>
<p>Here, we see that we have an xml_document and xml_node in our object. We want to save the tables in our data. To do this, we use the function <code>html_nodes()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_table &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(wikipage, <span class="st">&quot;table&quot;</span>)</code></pre></div>
<p>If you type <code>data_table</code>, you can see an overview of all the tables we have saved. Here, we would like to use the data on the number of votes the different parties got in the 2014 European Parliament election in the United Kingdom. The table is depicted in Figure <a href="create.html#fig:wikieptable">6.1</a>.</p>
<div class="figure"><span id="fig:wikieptable"></span>
<img src="fig/wikieptable.png" alt="The Wikipedia table with hte 2014 EP election in the UK " width="70%" />
<p class="caption">
Figure 6.1: The Wikipedia table with hte 2014 EP election in the UK
</p>
</div>
<p>In the figure, the title of the table is highlighted. If you copy the title and look up the source code of the page<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a>, you can search for the table in the source code. This will show you what the code looks like for the table. To see the code for all our tables, we can simply call <code>data_table</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_table</code></pre></div>
<p>We can see that this table is number 15 in our object. We save this table in the object <code>data_results</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_results &lt;-<span class="st"> </span>data_table[[<span class="dv">15</span>]]</code></pre></div>
<p>We can now use the function <code>html_table()</code> to save the table as a data frame. We use the option <code>fill=TRUE</code> as there are empty cells in the table. We save the table in the object <code>ep14_raw</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span><span class="kw">html_table</span>(data_results, <span class="dt">fill=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>To ensure that it is a data frame we are working with, we can use the function <code>class()</code> again.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(ep14_raw)</code></pre></div>
<p>We call the object <code>ep14_raw</code> as it is a raw table that needs further changes before we are satisfied. To get a sense of one of the issues with the data frame, we look at the last observations in the data frame with <code>tail()</code> (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(ep14_raw)</code></pre></div>
<p>Here we see that the last three rows are aggregated numbers unrelated to the votes for the individual parties. Accordingly, we would like to remove these observations. To remove the specific rows, we save the object without observations 32, 33 and 34.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw[<span class="op">-</span><span class="kw">c</span>(<span class="dv">32</span><span class="op">:</span><span class="dv">34</span>), ]</code></pre></div>
<p>Next, we use <code>head()</code> to see what our data frame looks like for the first observations (output not shown).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ep14_raw)</code></pre></div>
<p>We see two main issues. First, that the variable names are not unique and will need to be changed. We are interested in four of the variables, namely the name of the party, the number of votes, the vote share and the number of seats. We give the relevant variables names and give the other variables unimportant names (as we are going to ignore those).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(ep14_raw) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;V1&quot;</span>, <span class="st">&quot;party&quot;</span>, <span class="st">&quot;votes&quot;</span>, <span class="st">&quot;share&quot;</span>, <span class="st">&quot;V5&quot;</span>, 
                     <span class="st">&quot;seats&quot;</span>, <span class="st">&quot;V7&quot;</span>, <span class="st">&quot;V8&quot;</span>, <span class="st">&quot;V9&quot;</span>, <span class="st">&quot;V10&quot;</span>)</code></pre></div>
<p>Next, we can see that the first row is not an observation but variable names as well. Accordingly, we need to remove this observation as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>), ]</code></pre></div>
<p>To remove the irrelevant variables in our data frame, we use the <code>select()</code> function to select the relevant variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14_raw &lt;-<span class="st"> </span>ep14_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(party, votes, share, seats)</code></pre></div>
<p>The last thing to do is to tell <code>R</code> that three variables, <code>votes</code>, <code>share</code> and <code>seats</code> are numeric. Notice how we use the function <code>gsub()</code> to get rid of commas. We save this data frame in the object <code>ep14</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14 &lt;-<span class="st"> </span>ep14_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">votes =</span> <span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>,<span class="st">&quot;&quot;</span>, votes)),
    <span class="dt">share =</span> <span class="kw">as.numeric</span>(share),
    <span class="dt">seats =</span> <span class="kw">as.numeric</span>(seats)
  )</code></pre></div>
<p>Inspect the final data frame. In this case, we do not have a lot of observations and we simply show them all.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ep14</code></pre></div>
<p>Last, we create a figure showing the vote share and seats for the parties (notice that you will also need the package <code>ggrepel</code> to create the figure). (Output not shown)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ep14, <span class="kw">aes</span>(<span class="dt">x =</span> share, <span class="dt">y =</span> seats)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span>ggrepel<span class="op">::</span><span class="kw">geom_text_repel</span>(
    <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">ifelse</span>(share <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>, party, <span class="ot">NA</span>)),
      <span class="dt">size =</span> <span class="fl">4.5</span>,
      <span class="dt">point.padding =</span> .<span class="dv">2</span>,
      <span class="dt">box.padding =</span> .<span class="dv">4</span>
    ) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">y =</span> <span class="st">&quot;Number of seats&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;Vote share&quot;</span>,
    <span class="dt">title =</span> <span class="st">&quot;2014 European Parliament election, United Kingdom&quot;</span>
  )</code></pre></div>
</div>
<div id="scrape-political-speeches" class="section level2">
<h2><span class="header-section-number">6.3</span> Scrape political speeches</h2>
<p>A lot of the text we can scrape online is not in the form of spreadsheets but in the form of nothing but text. To show how to scrape such text, we will focus on British political speeches from <a href="http://www.britishpoliticalspeech.org/speech-archive.htm" class="uri">http://www.britishpoliticalspeech.org/speech-archive.htm</a>.</p>
<p>Specifically, we will select the speech the Leaderâs speech by Theresa May in Manchester from 2017. First, as in the previous example, we specify the url of the page we would like to scrape. In this speech, Theresa May is talking extensively about the British Dream.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;http://www.britishpoliticalspeech.org/speech-archive.htm?speech=367&quot;</span>
  )</code></pre></div>
<p>To get the content of the page with the speech, we save the content of the page in the object <code>speechpage</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">speechpage &lt;-<span class="st"> </span><span class="kw">read_html</span>(url)</code></pre></div>
<p>Next, to select the actual part of the page containing the speech, we select the content within the <code>&lt;p&gt;&lt;/p&gt;</code> tags.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(speechpage, <span class="st">&quot;p&quot;</span>)</code></pre></div>
<p>To get the actual text, we use the function <code>html_text()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech_text &lt;-<span class="st"> </span><span class="kw">html_text</span>(data_speech)</code></pre></div>
<p>Now we have all the text we need to use. However, to create a dataset with the words in the speech, we will use some functions from the package <code>tidytext</code> (as always, remember to install the package if you do not already have it installed) <span class="citation">(Silge &amp; Robinson, 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidytext&quot;</span>)</code></pre></div>
<p>The first function we are going to use is not part of the package but will be used to convert our speech into a data frame using the <code>data_frame()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_speech_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">text =</span> data_speech_text)</code></pre></div>
<p>While in a data frame, it is still just a lot of sentences on different rows. To unnest all the sentences in our text column into a word column, we use the function <code>unnest_tokens()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words &lt;-<span class="st"> </span>data_speech_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest_tokens</span>(word, text)</code></pre></div>
<p>This gives us an object, <code>words</code>, with 7,116 observations. However, a lot of these words are irrelevant stop words (most common words that we are not interested in such as <em>the</em>, <em>is</em>, <em>at</em>, <em>which</em>) that we would like to remove. We use the <code>anti_join()</code> function to remove all stop words.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words &lt;-<span class="st"> </span>words <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">anti_join</span>(stop_words, <span class="dt">by =</span> <span class="st">&quot;word&quot;</span>)</code></pre></div>
<p>Last, we can count the words in the speech and calculate the number of occurrences.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(word, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>We see that <em>people</em> is mentioned 49 times, and <em>britain</em> is mentioned 36 times. <em>dream</em> and <em>british</em> are mentioned 33 and 29 times, respectively.</p>
</div>
<div id="get-data-from-twitter" class="section level2">
<h2><span class="header-section-number">6.4</span> Get data from Twitter</h2>
<p>To get data from Twitter, we are going to use the <code>rtweet</code> package <span class="citation">(Kearney, 2018)</span>. The first thing we do is to load the package (remember to install if if you have not already done so). You can find more information about the package here: <a href="https://rtweet.info/" class="uri">https://rtweet.info/</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rtweet&quot;</span>)</code></pre></div>
<p>Next, to make sure you can collect data, you need to have a Twitter user. You can register for free at <a href="https://twitter.com/" class="uri">https://twitter.com/</a>. You will need this in order to use the <code>rstats2twitter</code> app. Last, make sure to install the <code>httpuv</code> package as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;httpuv&quot;</span>)</code></pre></div>
<p>Noteworthy, we cannot just collect data without any limits. In most cases, we have a liit of 18,000 observations per 15 minutes.</p>
<div id="data-on-twitter-user" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Data on Twitter user</h3>
<p>To get data on a Twitter user, we can use different functions. There is a distinction betweeen friends and followers. The accounts a user follows are called friends, whereas followers are the accounts that follow a user. Here, we will use the <code>get_friends()</code> function to get information on the people Donald Trump is following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_following &lt;-<span class="st"> </span><span class="kw">get_friends</span>(<span class="st">&quot;realDonaldTrump&quot;</span>)</code></pre></div>
<p>When we do that, all we get is a series of user IDs for the people Donald Trump is following. We can use the <code>lookup_users()</code> function toget more information about the individual accounts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_following &lt;-<span class="st"> </span><span class="kw">lookup_users</span>(trump_following<span class="op">$</span>user_id)</code></pre></div>
<p>This gives us a lot more information on the individual users, including their Twitter handle, name and description. To see all the information saved, you can use the <code>names()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(trump_following)</code></pre></div>
<p>To save information on the user ID, the handle, name and the description, we create a new object called <code>trump_data</code> just with these variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_data &lt;-<span class="st"> </span>trump_following <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(user_id, screen_name, name, description) </code></pre></div>
<p>You can use <code>head(trump_data)</code> to see what the data looks like. To get information on the followers of Donald Trump, you can use the <code>get_followers()</code> function. However, this will take a lot of time to get (we are talking days!).</p>
<p>To get the most recent tweets from, Donald Trump, we can use the <code>get_timeline()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trump_tweets &lt;-<span class="st"> </span><span class="kw">get_timeline</span>(<span class="st">&quot;realDonaldTrump&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>)</code></pre></div>
<p>To search for tweets from specific users, we can use the <code>search_users()</code> function. Below, we search for tweets from users with <code>politics</code> (via Twitters search query).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">politics_users &lt;-<span class="st"> </span><span class="kw">search_users</span>(<span class="st">&quot;politics&quot;</span>, <span class="dt">n =</span> <span class="dv">50</span>)</code></pre></div>
<p>Next, we can use the <code>get_favorites()</code> function to get data on the tweets a user has favorited. Here, we save the favorites from Boris Johnson and save it in the object <code>tweets_bj</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tweets_bj &lt;-<span class="st"> </span><span class="kw">get_favorites</span>(<span class="st">&quot;BorisJohnson&quot;</span>)</code></pre></div>
<p>To get a sense of what this data looks like, you can use the <code>head()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tweets_bj)</code></pre></div>
</div>
<div id="data-on-trends" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Data on trends</h3>
<p>To get data on what is trending in a certain part of the world, we can use the <code>get_trends()</code> function. Below, we get the 50 most trending topics in the United Kingdom. On October 29, 2018, <code>#NationalCatDay</code> and <code>Angela Merkel</code> are both trending (not for the same reason though).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trends_uk &lt;-<span class="st"> </span><span class="kw">get_trends</span>(<span class="st">&quot;united kingdom&quot;</span>)</code></pre></div>
</div>
<div id="data-on-tweets" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Data on tweets</h3>
<p>Last, to get data on specific tweets, we first use the <code>search_tweets()</code> function. Below, we get the most recent 100 tweets mentioning <code>brexit</code>. We also specify that we are not interested in retweets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">brexit &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(
  <span class="st">&quot;brexit&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>This gives us a data frame with 100 observations and 88 variables. You can use the <code>names()</code> function to get a list of all variables in the data frame.</p>
<p>You can also use the search operators provided by Twitter, e.g.Â by filtering only tweets linking to news articles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">news &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;filter:news&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>)</code></pre></div>
<p>We acn combine the two searches above and only search for tweets with Brexit related news.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">brexit_news &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;brexit filter:news&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>If we want to only include tweets with a video, we can use <code>&quot;filter:video&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">videos &lt;-<span class="st"> </span><span class="kw">search_tweets</span>(<span class="st">&quot;filter:video&quot;</span>, <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">include_rts =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>To look up data on a specific tweet, use the function <code>lookup_tweets()</code>. You can find the id on a tweet by looking in the url for a tweet (or in the variable <code>status_id</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lookup_tweets</span>(<span class="st">&quot;1065623990746710022&quot;</span>)</code></pre></div>
</div>
</div>
<div id="get-data-from-google-trends" class="section level2">
<h2><span class="header-section-number">6.5</span> Get data from Google Trends</h2>
<p>Google Trends is a great service that allows users to explore trends in the search interest for different terms. However, before you use this service make sure that you actually understand what the data is showing, e.g.Â by reading this article: <a href="https://medium.com/@dannypage/stop-using-google-trends-a5014dd32588">Stop Using Google Trends</a>.</p>
<p>To collect data from Google Trends, we are going to use the packages <code>gtrends</code> <span class="citation">(Massicotte &amp; Eddelbuettel, 2019)</span> and <code>trendyy</code> <span class="citation">(Parry, 2019)</span>. The latter is a tidy wrapper that provides an easier way to work with Google Trends data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;gtrendsR&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;trendyy&quot;</span>)</code></pre></div>
<p>To get trend data, we will use the function <code>trendy()</code>. To get trends, simply specify the term of interest and the period you would like to explore. Here, we are going to replicate Figure 1 in <span class="citation">Ares &amp; HernÃ¡ndez (2017)</span>. This study looks at a corruption scandal in Spain (the BÃ¡rcenas scandal). The period of interest here is from January 1 to June 1 in 2013. The term of interest is <code>caso barcenas</code>. We save this data in the object <code>cb</code> by using the function <code>get_interest()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cb &lt;-<span class="st"> </span><span class="kw">trendy</span>(<span class="st">&quot;caso barcenas&quot;</span>, 
             <span class="dt">from =</span> <span class="st">&quot;2013-01-01&quot;</span>,
             <span class="dt">to =</span> <span class="st">&quot;2013-06-01&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">get_interest</span>()</code></pre></div>
<p>In this data, we now have a <code>date</code> variable (with the date of interest) and a <code>hits</code> variable that shows the interest on the specific day. We can use the <code>ggplot2</code> package to replicate the figure in <span class="citation">Ares &amp; HernÃ¡ndez (2017)</span> (the next chapter will introduce this package so if you are unfamiliar with <code>ggplot2</code> at this stage, do return to this example later if you would like to understand the code in detail).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(cb, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.Date</span>(date), <span class="dt">y =</span> hits)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2013-01-31&quot;</span>), 
             <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, 
             <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Relative Google searches&quot;</span>,
       <span class="dt">caption =</span> <span class="st">&quot;Note: Red dashed line indicates January 31st&quot;</span>)</code></pre></div>
<p><img src="qpolr_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
</div>
<div id="get-data-from-wikipedia" class="section level2">
<h2><span class="header-section-number">6.6</span> Get data from Wikipedia</h2>
<p>As illustrated above, we can scrape tables from Wikipedia with the <code>rvest</code> package. However, we can also get more specific data on specific Wikipedia pages. To do this, we will use the package <code>pageviews</code> <span class="citation">(Keyes &amp; Lewis, 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;pageviews&quot;</span>)</code></pre></div>
<p>This package has a function called <code>article_pageviews()</code> that allows us to specify an article and the period for which we would like to get data on how many page views that article got. In the code below, we specify that we would like to get the number of page views on the article âBrexitâ from June 1 to July 1 in 2016.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get pageviews</span>
brexit_views &lt;-<span class="st"> </span><span class="kw">article_pageviews</span>(<span class="dt">project =</span> <span class="st">&quot;en.wikipedia&quot;</span>, 
                                  <span class="dt">article =</span> <span class="st">&quot;Brexit&quot;</span>, 
                                  <span class="dt">user_type =</span> <span class="st">&quot;user&quot;</span>, 
                                  <span class="dt">start =</span> <span class="st">&quot;2016060100&quot;</span>, 
                                  <span class="dt">end =</span> <span class="st">&quot;2016070100&quot;</span>)</code></pre></div>
<p>To see what the data looks like, use <code>head()</code>. Here we see that there was 896 page views on June 1 in 2016.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(brexit_views)</code></pre></div>
<pre><code>##     project language article     access agent granularity       date views
## 1 wikipedia       en  Brexit all-access  user       daily 2016-06-01   896
## 2 wikipedia       en  Brexit all-access  user       daily 2016-06-02   975
## 3 wikipedia       en  Brexit all-access  user       daily 2016-06-03   865
## 4 wikipedia       en  Brexit all-access  user       daily 2016-06-04   607
## 5 wikipedia       en  Brexit all-access  user       daily 2016-06-05   833
## 6 wikipedia       en  Brexit all-access  user       daily 2016-06-06  1297</code></pre>
<p>Again, we can use the <code>ggplot2</code> package to show the trends over time (return to the code below once you have read the chapters on data visualisation).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(brexit_views, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.Date</span>(date), <span class="dt">y =</span> views)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2016-06-23&quot;</span>), 
             <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, 
             <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Page views&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<p><img src="qpolr_files/figure-html/unnamed-chunk-201-1.png" width="672" /></p>
<p>If you are interested in learning more on how to work with Wikipedia, we recommend the following tutorial: <a href="https://www.mzes.uni-mannheim.de/socialsciencedatalab/article/studying-politics-wikipedia/">Studying Politics on and with Wikipedia</a>.</p>

</div>
</div>



<div class="footnotes">
<hr />
<ol start="9">
<li id="fn9"><p>To look up the source in Google Chrome, simply right click anywhere on the webpage and select <code>View Page Source</code>. If in doubt on how to find the source code, you can google the name of your browser and âview souce codeâ.<a href="create.html#fnref9">â©</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datadownload.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dataviz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["qpolr.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
